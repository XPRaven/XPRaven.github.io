<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Bibliothek</title>

    <link rel="stylesheet" href="main.css" id="style">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IM+Fell+DW+Pica:ital@0;1&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=IM+Fell+DW+Pica+SC" rel="stylesheet">
</head>
<body class="IM_Fell_DW_Pica">
<div id="center-div">
    <div id="notice">
        <p></p>
    </div>
    <div>
        <label for="search">
            <input type="search" id="search">
        </label>
    </div>
    <div>
        <label for="go">
            <input type="button" id="go" value="Öffnen" class="IM_Fell_DW_Pica_SC" onclick="loadDocument(document.getElementById('search').value)">
        </label>
    </div>
</div>
</body>
<script>
    document.getElementById('search').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            location.href= document.getElementById('search').value + '.html'
        }
    });

    async function loadDocument(filename) {
        if (!filename) {
            await showWarning('Leeres Feld', 1500);
            return;
        }
        try {
            let encryptedData = await fetchFile(filename);
            let decryptedData
            if (encryptedData) {
                decryptedData = decryptData(encryptedData);
            }
            if (decryptedData) {
                document.body.innerHTML = decryptedData;
                swapStylesheet(/* TODO: add new stylesheets */);
            }
        } catch (error) {
            console.error(error);
        }
    }

    async function fetchFile(filename) {
        try {
            const response = await fetch(filename);

            if (!response.ok) {
                await showWarning('Datei nicht verfügbar', 1500);
                throw new Error('Failed to fetch document');
            }
            return await response.text();
        } catch (error) {
            console.error(error);
        }
    }
    function decryptData(placeholder) {return placeholder}
    function swapStylesheet(filename) {
        document.getElementById("style").setAttribute("href", filename);
    }

    let noticeVisible = false;
    async function showWarning(message, duration) {
        const box = document.getElementById('notice');
        box.querySelector('p').textContent = message;

        if (noticeVisible) {
            box.style.background = 'rgba(255, 80, 80, 0.7)'
            setTimeout(() => {
                box.style.background = 'rgba(255, 80, 80, 0.35)';
            }, 40)
        }

        if (!noticeVisible)  {
            box.style.display = 'block';
            noticeVisible = true;

            setTimeout(() => {
                box.style.display = 'none';
                noticeVisible = false;
            }, duration);
        }
    }
</script>
</html>